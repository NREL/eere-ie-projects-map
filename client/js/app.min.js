!function(r){function e(r,e){var t=r||{};for(var n in e)e.hasOwnProperty(n)&&!t[n]&&(t[n]=e[n]);return t}function t(r,e){if(e.crs&&(r.crs={type:"name",properties:{name:e.crs}}),e.bbox&&(r.bbox=e.bbox),e.extraGlobal){r.properties={};for(var t in e.extraGlobal)r.properties[t]=e.extraGlobal[t]}}function n(r){r.geom={};for(var e in r)r.hasOwnProperty(e)&&-1!==f.indexOf(e)&&(r.geom[e]=r[e],delete r[e]);o(r.geom)}function o(r){for(var e in r)r.hasOwnProperty(e)&&("string"==typeof r[e]?c.push(r[e]):"object"==typeof r[e]&&(c.push(r[e][0]),c.push(r[e][1])));if(0===c.length)throw new Error("No geometry attributes specified")}function i(r,e,t){var n={type:"Feature"};return n.geometry=a(r,e),n.properties=t.call(r),n}function a(r,e){var t={};for(var n in e.geom){var o=e.geom[n];"string"==typeof o&&r.hasOwnProperty(o)?(t.type=n,t.coordinates=r[o]):Array.isArray(o)&&r.hasOwnProperty(o[0])&&r.hasOwnProperty(o[1])&&(t.type=n,t.coordinates=[r[o[1]],r[o[0]]])}return t}function u(r){var e;return r.exclude||r.include?r.include?e=function(e){r.include.forEach(function(r){e[r]=this[r]},this)}:r.exclude&&(e=function(e){for(var t in this)this.hasOwnProperty(t)&&-1===c.indexOf(t)&&-1===r.exclude.indexOf(t)&&(e[t]=this[t])}):e=function(r){for(var e in this)this.hasOwnProperty(e)&&-1===c.indexOf(e)&&(r[e]=this[e])},function(){var t={};return e.call(this,t),r.extra&&s(t,r.extra),t}}function s(r,e){for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t]);return r}r.version="0.2.0",r.defaults={},r.parse=function(r,o,a){var s,f={type:"FeatureCollection",features:[]},p=e(o,this.defaults);return c.length=0,n(p),s=u(p),r.forEach(function(r){f.features.push(i(r,p,s))}),t(f,p),a&&"function"==typeof a?void a(f):f};var f=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],c=[]}("object"==typeof module?module.exports:window.GeoJSON={});
"use strict";!function(){function e(e){Tabletop.init({key:e.url+e.qstring+e.googlekey,callback:t,simpleSheet:!0})}function t(e){b=e,r(b),n(b),i(g),c(g),u(b),l("Alaska"),o(b)}function a(e,t){var a=$("script").filter('[data-template="'+e+'"]').html(),n=Handlebars.compile(a);return n(t)}function n(e){var t=$("#ui-controls"),n={};Object.keys(g.uiFilters).forEach(function(t){n[t]=e.map(function(e){return e[t]}).sort().filter(function(e,t,a){return a.indexOf(e)===t})}),t.find("[data-target]").each(function(e,t){var r=$(t).data().target;$(t).append(a(r,n))}),t.on("change","input, select",function(){p(k),c(g),u(b),s(k,g),h()})}function r(e){e.forEach(function(e){e.Project='<a target="_blank" href="'+e.Link+'">'+e.Project+"</a>"})}function o(e){var t=g.dataHeaders.map(function(e){return{title:e,data:e}}),a='<"row"<"col-sm-6"l><"col-sm-6"f>><"row"<"col-sm-12"tr>><"row"<"col-sm-5"p><"col-sm-7"i>>';y=$("#"+g.datatableContainer).DataTable({data:e,columns:t,dom:a,language:{search:"Search table:"}})}function i(e){L.mapbox.accessToken=e.mapboxToken,v=L.mapbox.map(e.mapContainer).setView(e.mapCenter,e.mapZoom).addLayer(L.mapbox.tileLayer(e.tileLayer))}function c(e){Object.keys(e.uiFilters).forEach(function(t){var a=$('#ui-controls [data-target="'+t+'"] :checked');e.uiFilters[t].length=0,a.each(function(a,n){n.value.length&&e.uiFilters[t].push(n.value)})})}function u(e){function t(e){var t=e.getChildCount(),a=" marker-cluster-";return a+=10>t?"small":50>t?"medium":"large",new L.DivIcon({html:"<div><span>"+t+"</span></div>",className:"marker-cluster"+a,iconSize:new L.Point(40,40)})}k=new L.MarkerClusterGroup({spiderfyOnMaxZoom:!0,singleMarkerMode:!0,disableClusteringAtZoom:20,iconCreateFunction:t});var a=GeoJSON.parse(e,{Point:["Latitude","Longitude"]}),n=L.mapbox.featureLayer().setGeoJSON(a);n.setFilter(function(e){return f(e,g.uiFilters)}),n.eachLayer(function(e){var t="<h3>"+e.feature.properties.Tribe+"</h3>";t+="<h4>"+e.feature.properties.Project+"</h4>",e.bindPopup(t),e.setIcon(L.mapbox.marker.icon({})),k.addLayer(e)}),v.addLayer(k)}function l(e){var t=[];v.eachLayer(function(a){a===k&&a.eachLayer(function(a){a.feature.properties.State===e&&t.push(a)})}),$("#count-alaska").text(t.length)}function s(e,t){e.getLayers().length?v.fitBounds(e.getBounds()):(v.setView(t.mapCenter,t.mapZoom),alert("No projects fit the criteria."))}function p(e){void 0!==e?v.removeLayer(e):console.log("Marker layer was undefined. Nothing to remove.")}function f(e,t){var a=!0;return Object.keys(t).forEach(function(n){var r=void 0;e.properties[n]&&(r=e.properties[n].split(","),a=a&&d(r,t[n]))}),a}function d(e,t){var a=void 0;return a=t.length?t.some(function(t){return e.indexOf(t)>=0}):!0}function m(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function h(){Object.keys(g.uiFilters).forEach(function(e){var t=g.dataHeaders.indexOf(e),a=g.uiFilters[e].map(function(e){return e=m(e),"^"+e+"$"}),n=a.join("|");y.column(t).search(n,!0,!1)}),y.draw()}var g={googlekey:"1PeYaVWqSWABu6kWKI3VF48_iL-YLAyFJIo9j8Hnx73Y",url:"https://docs.google.com/spreadsheet/pub",qstring:"?hl=en_US&hl=en_US&output=html&key=",uiFilters:{State:[],Technology:[],Category:[]},mapCenter:[37.81,-95.84],mapZoom:4,mapboxToken:"pk.eyJ1IjoibnJlbCIsImEiOiJNOTcxYUhZIn0.Jc7TB_G2VQYs9e0S2laKcw",tileLayer:"mapbox.streets",mapContainer:"map",datatableContainer:"datatable",dataHeaders:["Project","Tribe","State","Year","Assistance Type","Category","Technology"]},v=void 0,y=void 0,b=void 0,k=void 0;window.onload=function(){e(g)},$(".map-navigation").on("click","a",function(e){e.preventDefault();var t=$(e.delegateTarget).children().data("position");if(t){var a=t.split(",");v.setView(a,4)}})}();